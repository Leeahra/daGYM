<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="eventMapper">
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM V_EVENT
		WHERE END_DATE >= SYSDATE
	</select>
	
	<resultMap type="Board" id="boardRs">
		<id property="boardNo" column="BOARD_NO"/>
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="boardWriter" column="MEMBER_ID"/>
		<result property="views" column="VIEWS"/>
		<result property="boardEnrollDate" column="BOARD_ENROLL_DATE" javaType="java.sql.Timestamp"/>
		<result property="startDate" column="START_DATE"/>
		<result property="endDate" column="END_DATE"/>
	</resultMap>
	
	<resultMap type="Board" id="infoRs">
			<id property="boardNo" column="BOARD_NO"/>
		<result property="boardWriter" column="MEMBER_ID"/>
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="boardEnrollDate" column="BOARD_ENROLL_DATE" javaType="java.sql.Timestamp"/>
		<result property="boardModifyDate" column="BOARD_MODIFY_DATE" javaType="java.sql.Timestamp"/>
		<result property="views" column="VIEWS"/>
	</resultMap>
	
    <resultMap type="Attachment" id="attachmentRs">
    	<id property="fileNo" column="FILE_NO"></id>
    	<result property="parentBoardNo" column="BOARD_NO"/>
    	<result property="fileOriginName" column="ORIGIN_NAME"/>
    	<result property="fileChangeName" column="CHANGED_NAME"/>
    	<result property="filePath" column="FILE_PATH"/>
    	<result property="fileLevel" column="FILE_LEVEL"/>
    </resultMap>
	
	<select id="selectList" resultMap="boardRs">
		SELECT * FROM V_EVENT
		WHERE END_DATE >= SYSDATE
		ORDER BY BOARD_NO DESC
	</select>
	
   	<select id="selectThumbnailList" parameterType="list" resultMap="attachmentRs">
   		SELECT * FROM ATTACHMENT
   		WHERE FILE_LEVEL = 0
   		AND BOARD_NO IN
   		<foreach collection="list" index="i" item="board"
   			open="(" close=")" separator=",">
   			#{board.boardNo}
   		</foreach>
   	</select>
	
	<!-- 게시글 삽입시 필요한 보드넘버 -->
	<select id="selectNextNo" resultType="_int">
		SELECT SEQ_BNO.NEXTVAL FROM DUAL
	</select>
	
	<insert id="insertBoard" parameterType="Board">
		INSERT INTO BOARD
		VALUES(#{boardNo}, #{boardWriter}, #{boardType}, #{boardTitle}, #{boardContent}, DEFAULT, DEFAULT, DEFAULT, DEFAULT, 
				#{startDate}, #{endDate}, DEFAULT)
	</insert>
	
	<insert id="insertAttachment" parameterType="Attachment">
	   	INSERT INTO ATTACHMENT VALUES(
   			SEQ_FNO.NEXTVAL, #{parentBoardNo},
   			#{fileOriginName}, #{fileChangeName}, #{filePath}, #{fileLevel}, DEFAULT
   		)
	</insert>
	<delete id="deleteAttachment" parameterType="_int">
   		DELETE FROM ATTACHMENT
   		WHERE BOARD_NO = #{boardNo}
    </delete>
    
    <select id="selectBoard" parameterType="_int" resultMap="boardRs">
    	SELECT * FROM V_EVENT
    	WHERE BOARD_NO = #{boardNo} 
    </select>
    
    <update id="increaseCount" parameterType="_int">
    	UPDATE BOARD
    	SET VIEWS = VIEWS + 1
    	WHERE BOARD_NO = #{boardNo}
    </update>
    
    <select id="selectFiles" parameterType="_int" resultMap="attachmentRs">
    	SELECT * FROM ATTACHMENT
    	WHERE BOARD_NO = #{boardNo}
    </select>
    
    <update id="deleteEvent" parameterType="_int">
    	UPDATE BOARD 
    	SET BOARD_STATUS = 'N'
    	WHERE BOARD_NO = #{boardNo}
    </update>
    
    <update id="updateEvent" parameterType="Board">
    	UPDATE BOARD SET
    	BOARD_TITLE = #{boardTitle},
    	BOARD_CONTENT = #{boardContent},
    	START_DATE = #{startDate},
    	END_DATE = #{endDate}
    	WHERE BOARD_NO = #{boardNo}
    </update>
    
    <update id="updateAttachment" parameterType="Attachment">
      	UPDATE ATTACHMENT SET
   		ORIGIN_NAME = #{fileOriginName},
   		CHANGED_NAME = #{fileChangeName}
   		WHERE FILE_NO = #{fileNo}
    </update>
    
    <delete id="deleteAttachmentOne" parameterType="_int">
    	DELETE FROM ATTACHMENT
   		WHERE FILE_NO = #{fileNo}
    </delete>
    
    <!-- 종료 이벤트 -->
    
	<select id="selectEndList" resultMap="boardRs">
		<![CDATA[
		SELECT * FROM V_EVENT
		WHERE END_DATE < SYSDATE
		ORDER BY BOARD_NO DESC
		]]>
	</select>
	
	<select id="getEndListCount" resultType="_int">
		<![CDATA[
		SELECT COUNT(*) FROM V_EVENT
		WHERE END_DATE < SYSDATE
		]]>
	</select>
	
	<!-- info -->
	<select id="getInfoListCount" resultType="_int">
		SELECT COUNT(*) FROM INFO_VIEW
	</select>
	
	<select id="selectInfoList" resultMap="infoRs">
		SELECT * FROM INFO_VIEW
	</select>
	
	<select id="selectInfo" resultMap="infoRs">
		SELECT * FROM INFO_VIEW
		WHERE BOARD_NO = #{boardNo}
	</select>
	
	<insert id="insertInfo" parameterType="Board">
		INSERT INTO BOARD
		VALUES(#{boardNo}, #{boardWriter}, #{boardType}, #{boardTitle}, #{boardContent}, DEFAULT, DEFAULT, DEFAULT, DEFAULT, 
				DEFAULT, DEFAULT, DEFAULT)
	</insert>
	
  
</mapper>
