<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="trainerMapper">
		<resultMap id="trainerResultSet" type="Trainer" >
		
		<id property="trainerNo" column="TRAINER_NO"/>
		
		<!-- DB 일반 컬럼에 해당하는 필드와 컬럼을 작성 -->
		<result property="memberId" column="MEMBER_ID" />
		<result property="memberPwd" column="MEMBER_PWD" />
		<result property="memberName" column="MEMBER_NM" />
		<result property="memberPhone" column="MEMBER_PHONE" />
		<result property="memberEmail" column="MEMBER_EMAIL" />
		<result property="trainerCareer" column="TRAINER_CAREER" />
		<result property="trainerMcnt" column="TRAINER_M_CNT" />
		<result property="memberEnrollDate" column="MEMBER_ENROLL_DATE" />
		<result property="memberStatus" column="MEMBER_STATUS" />
		<result property="trainerPrice" column="TRAINER_PRICE" />
		<result property="trainerSNS" column="TRAINER_SNS" />	
		<result property="trainerAward" column="TRAINER_AWARD" />	
		<result property="trainerComment" column="TRAINER_COMMENT" />		
	</resultMap>
	
	 <resultMap type="trainerAttachment" id="trainerAttachmentResultSet">
        <id property="fileNo" column="FILE_NO"/>
        <result property="parentTrainerNo" column="PARENT_TRAINER_NO"/>
        <result property="fileOriginName" column="FILE_ORIGIN_NAME"/>
        <result property="fileChangeName" column="FILE_CHANGE_NAME"/>
        <result property="filePath" column="FILE_PATH"/>
        <result property="fileLevel" column="FILE_LEVEL"/>
    </resultMap>
    
	<select id="selectList" resultMap="trainerResultSet">
SELECT * FROM TRAINER JOIN MEMBER ON(MEMBER_NO=TRAINER_NO)WHERE MEMBER_STATUS='Y'
	</select>
	
	
	<select id="selectTrainer" parameterType="_int" resultMap="trainerResultSet">
	SELECT * FROM TRAINER JOIN MEMBER ON(MEMBER_NO=TRAINER_NO)WHERE MEMBER_STATUS='Y' AND TRAINER_NO=#{trainerNo}
	</select>


	 <select id="selectNextNo" resultType="_int">
        SELECT SEQ_MNO.NEXTVAL FROM DUAL
    </select>
	

	<insert id="insertTrainer" parameterType="Trainer">
		INSERT ALL INTO MEMBER VALUES(#{trainerNo}, #{memberId}, #{memberPwd},
		 #{memberName},#{memberPhone},#{memberEmail}, DEFAULT, DEFAULT, DEFAULT)
         INTO TRAINER VALUES(#{trainerNo},#{trainerCareer},DEFAULT,#{trainerPrice},
         #{trainerSNS},#{trainerComment},#{trainerAward})
SELECT * FROM DUAL
	</insert>
	

	<!-- 파일 정보 삽입 -->
	<insert id="insertAttachment" parameterType="TrainerAttachment">
		INSERT INTO TRAINER_ATTACHMENT VALUES(SEQ_TFNO.NEXTVAL,#{parentTrainerNo}, #{fileOriginName}, #{fileChangeName}, #{filePath}, #{fileLevel})
	</insert>
	

     <select id="selectFiles" parameterType="_int" resultMap="trainerAttachmentResultSet">
     	SELECT * FROM TRAINER_ATTACHMENT WHERE PARENT_TRAINER_NO=#{trainerNo} ORDER BY FILE_LEVEL
     </select>

     <delete id="deleteAttachment" parameterType="_int">
     	DELETE FROM TRAINER_ATTACHMENT
     	WHERE PARENT_TRAINER_NO = #{trainerNo}
     </delete>
	
	  
	<select id="selectThumbnailList" parameterType="list" resultMap="trainerAttachmentResultSet">
		SELECT * FROM TRAINER_ATTACHMENT
		WHERE FILE_LEVEL = 0
		AND PARENT_TRAINER_NO IN
		<foreach collection="list" index="i" item="trainer"
			open="(" close=")" separator=",">
		#{trainer.trainerNo}
		</foreach>
	</select>
	
	<!-- 거래번호 생성 -->
	<select id="createMerchantUid" resultType="_int">
		SELECT SEQ_PAY.NEXTVAL FROM DUAL
	</select>
	
	
	<!-- 결제하기 -->
	<insert id="insertOrder" parameterType="map">
		INSERT INTO PAYMENT VALUES(#{payment.merchantUid}, #{payment.classNm}, #{payment.amount}, SYSDATE, #{payment.memberNo}, #{payment.trainerNo})
	</insert>
	 
	
	<!-- 트레이너 가격조회 -->
  	<select id="selectPrice" parameterType="_int" resultType="_int">
  		SELECT TRAINER_PRICE FROM TRAINER WHERE TRAINER_NO=#{trainerNo}
  	</select>
  	
  	<!-- 수강권 삽입 -->
  	<insert id="insertCoupon" parameterType="Payment">
  		INSERT INTO CLASS_STATUS VALUES(#{memberNo}, #{trainerNo}, #{classNm})
  		
  	</insert>
	
  
</mapper>
